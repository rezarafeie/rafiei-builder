
import { useState, useEffect } from 'react';

export type Language = 'en' | 'fa';

const translations = {
  en: {
    // General
    appName: 'Rafiei Builder',
    you: 'You',
    placeholder: 'Describe your app...',
    footer: 'Powered by Gemini 3 Pro & Flash Lite',
    welcome: 'Welcome',
    projects: 'Projects',
    newProject: 'New Project',
    deploy: 'Preview',
    settings: 'Settings',
    admin: 'Admin',
    logout: 'Log out',
    syncing: 'Syncing...',
    local: 'Local Mode',
    cloud: 'Cloud Connected',
    preview: 'Preview',
    code: 'Code',
    split: 'Split',
    adminPanel: 'Admin Control Panel',
    ready: 'Ready to build something amazing today?',
    selectProject: 'Select a Project',
    saveConnect: 'Save & Connect',
    disconnect: 'Disconnect',
    requiredSql: 'Required SQL Setup',
    managedCode: 'Database configuration is managed via source code. Updates here are disabled.',
    configureGlobal: 'Configure the global database connection for the application.',
    projectUrl: 'Project URL',
    anonKey: 'Anon Key',
    publish: 'Publish',
    live: 'Live',
    visitors: 'Visitors',
    editDomain: 'Edit domain',
    manageDomains: 'Manage domains',
    whoCanAccess: 'Who can access?',
    anyone: 'Anyone',
    securityScan: 'Security Scan',
    reviewSecurity: 'Review security',
    updated: 'Updated',
    connectBackend: 'Connect your Backend',
    trash: 'Trash',
    restore: 'Restore',
    deleteForever: 'Delete Forever',
    emptyTrash: 'Trash is empty',
    emptyTrashDesc: 'Projects you delete will appear here.',
    projectsDesc: 'Manage and deploy your AI-generated applications.',
    trashDesc: 'Recover deleted projects or permanently remove them.',
    back: 'Back',
    cancel: 'Cancel',
    close: 'Close',
    add: 'Add',
    create: 'Create',
    delete: 'Delete',
    loading: 'Loading...',
    error: 'Error',
    retry: 'Retry',
    
    // Auth
    login: 'Log in',
    signup: 'Sign up',
    createAccount: 'Create Account',
    fullName: 'Full Name',
    emailAddress: 'Email Address',
    password: 'Password',
    signIn: 'Sign In',
    protectedBy: 'Protected by Rafiei Builder Cloud Security.',
    authFailed: 'Authentication failed',
    welcomeTitle: 'Welcome to Rafiei Builder',
    loginDesc: 'Sign in to access your projects',
    signupDesc: 'Create an account to start building',
    haveAccount: 'Already have an account? Sign in',
    noAccount: "Don't have an account? Sign up",
    getStarted: 'Get started',
    dashboard: 'Dashboard',

    // Landing
    geminiBadge: 'Gemini 3 Pro in Rafiei Builder',
    heroTitle: 'Build something',
    heroDesc: 'Create apps and websites by chatting with AI.',
    creatingProject: 'Creating your project...',

    // Dashboard
    startNewProject: 'Start a new project',
    describeApp: 'Describe the application you want to build.',
    systemDb: 'System DB',
    globalCloud: 'Global Cloud',
    provisioning: 'Provisioning...',
    connectCloud: 'Connect to Rafiei Cloud',
    systemConnectionIssue: 'System Connection Issue',
    unableToLoadProjects: 'Unable to load projects from the platform database.',
    runSetupWizard: 'Run Setup Wizard',
    noProjectsYet: 'No projects yet',
    personalProject: 'Personal Project',
    moveToTrash: 'Move to Trash',
    connectionStatus: 'Connection Status',
    connectedToSupabase: 'Connected to Supabase',
    connectionFailed: 'Connection Failed',
    refreshConnection: 'Refresh Connection',
    dbSetupTitle: 'Database Setup & Health',
    projectsTable: 'Projects Table',
    migrations: 'Migrations & Schema Updates',
    rafieiCloudTable: 'Rafiei Cloud Table',
    rlsPolicies: 'Security Policies (RLS)',
    automationTriggers: 'Automation Triggers',
    verify: 'Verify',
    installed: 'Installed',
    viewSql: 'View SQL',
    hideSql: 'Hide SQL',
    checking: 'Checking...',
    verificationFailed: 'Verification Failed',
    goodMorning: 'Good morning',
    goodAfternoon: 'Good afternoon',
    goodEvening: 'Good evening',

    // Credits
    manageCredits: 'Manage Credits',
    currentBalance: 'Current Balance',
    buyCredits: 'Buy Credits',
    transactionHistory: 'Transaction History',
    addFunds: 'Add Funds',
    payAsYouGo: 'Pay-As-You-Go. 10 Credits ≈ $1 USD.',
    amountCredits: 'Amount (Credits)',
    totalPrice: 'Total Price',
    exchangeRate: 'Exchange Rate',
    payWithZarinpal: 'Pay with Zarinpal',
    payWithStripe: 'Pay with Stripe',
    securePayment: 'Secure payment via',
    creditPurchase: 'Credit Purchase',
    adminAdjustment: 'Admin Adjustment',
    transaction: 'Transaction',
    minimumPurchase: 'Minimum purchase is 1 Credit',
    successfullyAdded: 'Successfully added',
    credits: 'Credits',
    toman: 'Toman',
    noTransactions: 'No transactions found.',

    // Cloud Management
    overview: 'Overview',
    database: 'Database',
    auth: 'Auth',
    users: 'Users',
    storage: 'Storage',
    functions: 'Functions',
    secrets: 'Secrets',
    logs: 'Logs',
    instance: 'Instance',
    paused: 'Paused',
    active: 'Active',
    openSupabase: 'Open in Supabase',
    projectHealth: 'Project Health',
    quickActions: 'Quick Actions',
    queryData: 'Query Data',
    manageUsers: 'Manage Users',
    tables: 'Tables',
    sqlEditor: 'SQL Editor',
    executeSql: 'Execute SQL',
    runQuery: 'Run Query',
    authSettings: 'Authentication Settings',
    authSettingsDesc: 'Configure how users sign up and log in.',
    saveChanges: 'Save Changes',
    emailSignup: 'Email Signup',
    emailSignupDesc: 'Allow users to sign up with email/password.',
    emailConfirmations: 'Email Confirmations',
    emailConfirmationsDesc: 'Require email verification before sign in.',
    anonSignins: 'Anonymous Sign-ins',
    anonSigninsDesc: 'Allow temporary guest access.',
    phoneSignup: 'Phone Signup',
    phoneSignupDesc: 'Allow users to sign up with SMS.',
    inviteUser: 'Invite User',
    created: 'Created',
    lastSignIn: 'Last Sign In',
    buckets: 'Buckets',
    createBucket: 'Create Bucket',
    deleteBucket: 'Delete Bucket',
    bucketEmpty: 'Bucket is empty',
    rowsFetched: 'rows fetched',
    noDataFound: 'No data found in this table.',
    selectBucket: 'Select a bucket to view files',
    selectTable: 'Select a table to view data',
    
    // Builder
    rafieiCloudConnected: 'Rafiei Cloud Connected',
    openCloudMgmt: 'Open Cloud Management',
    openProjectSettings: 'Open Project Settings',
    status: 'Status',
    projectName: 'Project Name',
    projectRef: 'Project Ref',
    region: 'Region',
    aiFullAccess: 'The AI agent has full access to this project to run migrations, manage auth, and store data.',
    projectInTrash: 'Project is in Trash',
    goToTrash: 'Go to Trash',
    projectUnavailable: 'Project Unavailable',
    
    // Chat
    startBuilding: 'Start building your dream app...',
    generatingSuggestions: 'Generating suggestions...',
    next: 'Next:',
    dropImages: 'Drop images to upload',
    attemptFix: 'Attempt Fix',
    runtimeError: 'Runtime Error Detected',
    autoFixError: 'Auto-Fix Error',

    // Terminals
    buildFailed: 'Build Failed',
    buildComplete: 'Build Complete',
    planning: 'Planning...',
    building: 'Building...',
    selfHealing: 'Self-Healing Mode',
    analyzingReqs: 'Analyzing requirements...',
    retryJob: 'Retry Job',
    cloudConnected: 'Cloud Connected',
    connectingCloud: 'Connecting to Rafiei Cloud',
    backendReady: 'Backend ready. Resuming build...',
    connectionFailedTitle: 'Connection Failed',
    provisioningProject: 'Provisioning cloud project...',
    wakingDatabase: 'Waking up database...',
    unknownError: 'An unknown error occurred.',

    // Domains
    customDomains: 'Custom Domains',
    addDomain: 'Add New Domain',
    domainPlaceholder: 'e.g. my-awesome-app.com',
    domainSupport: 'Both root (example.com) and subdomains (app.example.com) are supported.',
    verified: 'Verified',
    verificationPending: 'Verification Pending',
    configuration: 'Configuration',
    type: 'Type',
    value: 'Value',
    primary: 'Primary'
  },
  fa: {
    // General
    appName: 'رفیعی بیلدر',
    you: 'شما',
    placeholder: 'برنامه خود را توصیف کنید...',
    footer: 'قدرت گرفته از جمینای ۳ پرو و فلش لایت',
    welcome: 'خوش آمدید',
    projects: 'پروژه‌ها',
    newProject: 'پروژه جدید',
    deploy: 'پیش‌نمایش',
    settings: 'تنظیمات',
    admin: 'مدیریت',
    logout: 'خروج',
    syncing: 'در حال همگام‌سازی...',
    local: 'حالت محلی',
    cloud: 'متصل به ابر',
    preview: 'پیش‌نمایش',
    code: 'کد',
    split: 'دو بخشی',
    adminPanel: 'پنل مدیریت',
    ready: 'آماده‌اید چیزی شگفت‌انگیز بسازید؟',
    selectProject: 'انتخاب پروژه',
    saveConnect: 'ذخیره و اتصال',
    disconnect: 'قطع اتصال',
    requiredSql: 'تنظیمات SQL مورد نیاز',
    managedCode: 'پیکربندی پایگاه داده از طریق کد مدیریت می‌شود.',
    configureGlobal: 'پیکربندی اتصال پایگاه داده جهانی.',
    projectUrl: 'آدرس پروژه',
    anonKey: 'کلید عمومی',
    publish: 'انتشار',
    live: 'آنلاین',
    visitors: 'بازدیدکنندگان',
    editDomain: 'ویرایش دامنه',
    manageDomains: 'مدیریت دامنه‌ها',
    whoCanAccess: 'چه کسی دسترسی دارد؟',
    anyone: 'هر کسی',
    securityScan: 'اسکن امنیتی',
    reviewSecurity: 'بررسی امنیت',
    updated: 'بروزرسانی شده',
    connectBackend: 'اتصال بک‌اند',
    trash: 'زباله‌دان',
    restore: 'بازیابی',
    deleteForever: 'حذف دائمی',
    emptyTrash: 'زباله‌دان خالی است',
    emptyTrashDesc: 'پروژه‌هایی که حذف می‌کنید اینجا ظاهر می‌شوند.',
    projectsDesc: 'مدیریت و انتشار برنامه‌های تولید شده توسط هوش مصنوعی.',
    trashDesc: 'بازیابی پروژه‌های حذف شده یا حذف دائمی آن‌ها.',
    back: 'بازگشت',
    cancel: 'لغو',
    close: 'بستن',
    add: 'افزودن',
    create: 'ایجاد',
    delete: 'حذف',
    loading: 'در حال بارگذاری...',
    error: 'خطا',
    retry: 'تلاش مجدد',
    
    // Auth
    login: 'ورود',
    signup: 'ثبت نام',
    createAccount: 'ایجاد حساب کاربری',
    fullName: 'نام و نام خانوادگی',
    emailAddress: 'آدرس ایمیل',
    password: 'رمز عبور',
    signIn: 'ورود',
    protectedBy: 'محافظت شده توسط امنیت ابری رفیعی بیلدر.',
    authFailed: 'احراز هویت ناموفق بود',
    welcomeTitle: 'به رفیعی بیلدر خوش آمدید',
    loginDesc: 'برای دسترسی به پروژه‌ها وارد شوید',
    signupDesc: 'برای شروع ساخت حساب کاربری بسازید',
    haveAccount: 'حساب کاربری دارید؟ وارد شوید',
    noAccount: 'حساب کاربری ندارید؟ ثبت نام کنید',
    getStarted: 'شروع کنید',
    dashboard: 'داشبورد',

    // Landing
    geminiBadge: 'جمینای ۳ پرو در رفیعی بیلدر',
    heroTitle: 'چیزی بسازید',
    heroDesc: 'با چت کردن با هوش مصنوعی برنامه و وب‌سایت بسازید.',
    creatingProject: 'در حال ایجاد پروژه...',

    // Dashboard
    startNewProject: 'شروع پروژه جدید',
    describeApp: 'برنامه‌ای که می‌خواهید بسازید را توصیف کنید.',
    systemDb: 'پایگاه داده سیستم',
    globalCloud: 'ابر جهانی',
    provisioning: 'در حال آماده‌سازی...',
    connectCloud: 'اتصال به رفیعی کلود',
    systemConnectionIssue: 'مشکل اتصال سیستم',
    unableToLoadProjects: 'بارگذاری پروژه‌ها امکان‌پذیر نیست.',
    runSetupWizard: 'اجرای ویزارد نصب',
    noProjectsYet: 'هنوز پروژه‌ای نیست',
    personalProject: 'پروژه شخصی',
    moveToTrash: 'انتقال به زباله‌دان',
    connectionStatus: 'وضعیت اتصال',
    connectedToSupabase: 'متصل به سوپابیس',
    connectionFailed: 'اتصال ناموفق',
    refreshConnection: 'بروزرسانی اتصال',
    dbSetupTitle: 'تنظیمات و سلامت پایگاه داده',
    projectsTable: 'جدول پروژه‌ها',
    migrations: 'مهاجرت‌ها و بروزرسانی‌های اسکیما',
    rafieiCloudTable: 'جدول رفیعی کلود',
    rlsPolicies: 'سیاست‌های امنیتی (RLS)',
    automationTriggers: 'تریگرهای خودکار',
    verify: 'تایید',
    installed: 'نصب شده',
    viewSql: 'نمایش SQL',
    hideSql: 'مخفی کردن SQL',
    checking: 'در حال بررسی...',
    verificationFailed: 'تایید ناموفق',
    goodMorning: 'صبح بخیر',
    goodAfternoon: 'ظهر بخیر',
    goodEvening: 'عصر بخیر',

    // Credits
    manageCredits: 'مدیریت اعتبار',
    currentBalance: 'موجودی فعلی',
    buyCredits: 'خرید اعتبار',
    transactionHistory: 'تاریخچه تراکنش‌ها',
    addFunds: 'افزایش موجودی',
    payAsYouGo: 'پرداخت به ازای مصرف. ۱۰ اعتبار ≈ ۱ دلار آمریکا.',
    amountCredits: 'مقدار (اعتبار)',
    totalPrice: 'قیمت کل',
    exchangeRate: 'نرخ ارز',
    payWithZarinpal: 'پرداخت با زرین‌پال',
    payWithStripe: 'پرداخت با استرایپ',
    securePayment: 'پرداخت امن از طریق',
    creditPurchase: 'خرید اعتبار',
    adminAdjustment: 'تنظیمات مدیر',
    transaction: 'تراکنش',
    minimumPurchase: 'حداقل خرید ۱ اعتبار است',
    successfullyAdded: 'با موفقیت اضافه شد',
    credits: 'اعتبار',
    toman: 'تومان',
    noTransactions: 'هیچ تراکنشی یافت نشد.',

    // Cloud Management
    overview: 'نمای کلی',
    database: 'پایگاه داده',
    auth: 'احراز هویت',
    users: 'کاربران',
    storage: 'ذخیره‌سازی',
    functions: 'توابع',
    secrets: 'اسرار',
    logs: 'لاگ‌ها',
    instance: 'نمونه',
    paused: 'متوقف شده',
    active: 'فعال',
    openSupabase: 'باز کردن در سوپابیس',
    projectHealth: 'سلامت پروژه',
    quickActions: 'اقدامات سریع',
    queryData: 'پرس‌وجوی داده‌ها',
    manageUsers: 'مدیریت کاربران',
    tables: 'جداول',
    sqlEditor: 'ویرایشگر SQL',
    executeSql: 'اجرای SQL',
    runQuery: 'اجرای پرس‌وجو',
    authSettings: 'تنظیمات احراز هویت',
    authSettingsDesc: 'پیکربندی نحوه ثبت نام و ورود کاربران.',
    saveChanges: 'ذخیره تغییرات',
    emailSignup: 'ثبت نام با ایمیل',
    emailSignupDesc: 'اجازه ثبت نام با ایمیل/رمز عبور.',
    emailConfirmations: 'تایید ایمیل',
    emailConfirmationsDesc: 'نیاز به تایید ایمیل قبل از ورود.',
    anonSignins: 'ورود ناشناس',
    anonSigninsDesc: 'اجازه دسترسی مهمان موقت.',
    phoneSignup: 'ثبت نام با شماره تلفن',
    phoneSignupDesc: 'اجازه ثبت نام با پیامک.',
    inviteUser: 'دعوت کاربر',
    created: 'ایجاد شده',
    lastSignIn: 'آخرین ورود',
    buckets: 'سطل‌ها',
    createBucket: 'ایجاد سطل',
    deleteBucket: 'حذف سطل',
    bucketEmpty: 'سطل خالی است',
    rowsFetched: 'ردیف دریافت شد',
    noDataFound: 'داده‌ای در این جدول یافت نشد.',
    selectBucket: 'یک سطل را برای مشاهده فایل‌ها انتخاب کنید',
    selectTable: 'یک جدول را برای مشاهده داده‌ها انتخاب کنید',
    
    // Builder
    rafieiCloudConnected: 'رفیعی کلود متصل شد',
    openCloudMgmt: 'باز کردن مدیریت کلود',
    openProjectSettings: 'باز کردن تنظیمات پروژه',
    status: 'وضعیت',
    projectName: 'نام پروژه',
    projectRef: 'مرجع پروژه',
    region: 'منطقه',
    aiFullAccess: 'هوش مصنوعی دسترسی کامل برای مدیریت مهاجرت‌ها، احراز هویت و ذخیره داده‌ها دارد.',
    projectInTrash: 'پروژه در زباله‌دان است',
    goToTrash: 'رفتن به زباله‌دان',
    projectUnavailable: 'پروژه در دسترس نیست',
    
    // Chat
    startBuilding: 'ساخت برنامه رویایی خود را شروع کنید...',
    generatingSuggestions: 'در حال تولید پیشنهادات...',
    next: 'بعدی:',
    dropImages: 'تصاویر را اینجا رها کنید',
    attemptFix: 'تلاش برای تعمیر',
    runtimeError: 'خطای زمان اجرا شناسایی شد',
    autoFixError: 'تعمیر خودکار خطا',

    // Terminals
    buildFailed: 'ساخت ناموفق بود',
    buildComplete: 'ساخت کامل شد',
    planning: 'برنامه‌ریزی...',
    building: 'در حال ساخت...',
    selfHealing: 'حالت خود-تعمیری',
    analyzingReqs: 'تحلیل نیازمندی‌های پروژه...',
    retryJob: 'تلاش مجدد کار',
    cloudConnected: 'متصل به ابر',
    connectingCloud: 'در حال اتصال به رفیعی کلود',
    backendReady: 'بک‌اند آماده است. در حال ادامه ساخت...',
    connectionFailedTitle: 'اتصال ناموفق',
    provisioningProject: 'در حال آماده‌سازی پروژه ابری...',
    wakingDatabase: 'در حال بیدار کردن دیتابیس...',
    unknownError: 'یک خطای ناشناخته رخ داد.',

    // Domains
    customDomains: 'دامنه‌های سفارشی',
    addDomain: 'افزودن دامنه جدید',
    domainPlaceholder: 'مثال: my-awesome-app.com',
    domainSupport: 'هر دو دامنه ریشه (example.com) و زیر دامنه (app.example.com) پشتیبانی می‌شوند.',
    verified: 'تایید شده',
    verificationPending: 'در انتظار تایید',
    configuration: 'پیکربندی',
    type: 'نوع',
    value: 'مقدار',
    primary: 'اصلی'
  }
};

// Global Event Bus for Language
const listeners = new Set<(lang: Language) => void>();
let currentLang: Language = 'en';

export const setLanguage = (lang: Language) => {
  currentLang = lang;
  document.documentElement.dir = lang === 'fa' ? 'rtl' : 'ltr';
  document.documentElement.lang = lang;
  // Apply font based on language
  document.body.style.fontFamily = lang === 'fa' ? '"Vazirmatn", sans-serif' : '"Inter", sans-serif';
  listeners.forEach(l => l(lang));
};

export const useTranslation = () => {
  const [lang, setLang] = useState<Language>(currentLang);

  useEffect(() => {
    const handler = (l: Language) => setLang(l);
    listeners.add(handler);
    return () => { listeners.delete(handler); };
  }, []);

  const toggleLanguage = () => {
      setLanguage(lang === 'en' ? 'fa' : 'en');
  };

  return {
    t: (key: keyof typeof translations['en']) => (translations[lang] || translations['en'] as any)[key] || key,
    dir: lang === 'fa' ? 'rtl' : 'ltr',
    lang,
    setLanguage,
    toggleLanguage
  };
};
